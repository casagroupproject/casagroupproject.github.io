
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>city portfolio</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />


	<!-- Google Webfonts -->
	<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet"> 
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Simple Line Icons -->
<!-- 	<link rel="stylesheet" href="css/simple-line-icons.css"> -->
	<!-- Theme Style -->
	<link rel="stylesheet" href="css/stylesSub.css">
	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Main JS -->
	<script src="js/main.js"></script>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/87/three.min.js"></script>
<!-- 	<script src="js/OBJLoader.js"></script> -->
	<script src="js/STLLoader.js"></script>
<!-- 	<script src="js/MTLLoader.js"></script> -->
	<script src="js/OrbitControls.js"></script>
	<script src="js/processing.min.js"></script>
	
	<style>

	/** {
		background-color:black;
	}*/
		#c {
			position: fixed;
			left: 0px;
			width: 100%;
			height: 100%;
			background-color:black
		}


		.fh5co-portfolio-figure .scene {
				width: 100%;
				height: 100%;
				display:flex;
		}

		.processing{
			display:flex;
			margin: 0;
   			padding: 0;
   			outline : none;
   			width: 100%;
		}

		.title2 {
		z-index: 999;
	/*	display:flex;*/
		position: absolute;
		text-align:left;
		float:left;
		margin-top: 4em;
		}

	.whatevs {
		z-index: 998;
		position: absolute;
	/*	display:inline-block;*/
		text-align:center;
		float:right;
		margin-top: 40em;
		margin-left:11em;
	/*	padding-bottom: 10em;*/
		}

			/*** Works on common browsers ***/
	::selection {
	    background-color: #fdf894;
	    color: white;
	}

	/*** Mozilla based browsers ***/
	::-moz-selection {
	    background-color: #fdf894;
	    color: white;
	}

	/***For Other Browsers ***/
	::-o-selection {
	    background-color: #fdf894;
	    color: white;
	}

	::-ms-selection {
	    background-color: #fdf894;
	    color: white;
	}

	/*** For Webkit ***/
	::-webkit-selection {
	    background-color: #fdf894;
	    color: white;
	}

.vl {
    border-left: 1px solid white;
    height: 30px;
    padding-left: 1px;
}

	</style>


	</head>

	<body style="background-color:black">
		
		<canvas id="c"></canvas>

		<div id="fh5co-portfolio" style="background-color:black">
			<div class="fh5co-portfolio-item fh5co-img-right ">
				<!-- <div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless London</h2>
					<p>'Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia.'</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light Density: 45.5 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
					<!-- <h5> </h5> -->
				</div>
			</div>
			<div class="fh5co-portfolio-item fh5co-img-right">
			<!-- <div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless New York City</h2>
					<h5>Total population: 8'580'015</h5>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light Density: 42.2 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
				</div>
			</div>
			<div class="fh5co-portfolio-item fh5co-img-right">
			<!-- 	<div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless Tokyo</h2>
					<h5>Total population: 38'305'000</h5>
					<p>“(19:45:47) Takamaki-san, isn’t it a little too late to still be in your sleep attire? Legend says, when you can't sleep at night, it's because you're awake in someone else's body (12:26:02) I’m finally getting sleepy. Let’s sleep y’all.”</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light density: 22.9 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
				</div>
			</div>
			<div class="fh5co-portfolio-item fh5co-img-right">
				<!-- <div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless Sydney</h2>
					<h5>Total population: 4'626'000</h5>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light density: 15.6 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
				</div>
			</div>
			<div class="fh5co-portfolio-item fh5co-img-right">
				<!-- <div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless Stockholm</h2>
					<h5>Total population: 1'550'000</h5>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light density: 12.7 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
				</div>
			</div>
				<div class="fh5co-portfolio-item fh5co-img-right">
				<!-- <div class="fh5co-portfolio-figure"></div> -->
				<div class="fh5co-portfolio-description">
					<h2 style='color:#f6f062'>Sleepless Delhi</h2>
					<h5>Total population: 27'928'000</h5>
					<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean. A small river named Duden flows by their place and supplies it with the necessary regelialia.</p>
					<p style='color:white'>Total population: 10'657'000<br>
					Average daily Tweet count: 60<br>
					Average Light density: 55.5 (pixel average)<br>
					Number of Tweets on 'Sleep' in May 2017:</p>
					<canvas class='processing' data-processing-sources="./assets/tokyo.pde"></canvas>
				</div>
			</div>
		</div>

		<script id="template" type="notjs">
			<div class="title2">1 voxel = 5km. Total length = 750km </div>
			<div class="whatevs"> <p style="padding-top:1em;"> <a href="index.html">&#9664; Go back</a> or <a href="circadian.html">Explore health effects &#9658;</a> </p> </div>
			<div class="scene"></div>
			
		</script>

		<script>

			var canvas;

			var scenes = [],renderer;

			var objArr = [];

			var dens =['23','34','65','78','38','40'];

			//external geometires
			var models = {
			  model1: {
			    obj: "./assets/test.stl",
			    // mtl: "https://casagroupproject.github.io/template1/assets/Tent_Poles_01.mtl",
			    mesh: null
			  },
			  model2: {
			    obj: "./assets/test.stl",
			    // mtl: "https://casagroupproject.github.io/template1/assets/Tent_Poles_01.mtl",
			    mesh: null
			  },
			   model3: {
			    obj: "./assets/test.stl",
			    mtl: "./assets/Pirateship.mtl",
			    mesh: null
			  }, 
			  model4: {
			    obj: "./assets/test.stl",
			    // mtl: "https://casagroupproject.github.io/template1/assets/Tent_Poles_01.mtl",
			    mesh: null
			  },
			   model5: {
			    obj: "./assets/test.stl",
			    // mtl: "https://casagroupproject.github.io/template1/assets/Tent_Poles_01.mtl",
			    mesh: null
			  },
			   model6: {
			    obj: "./assets/test.stl",
			    // mtl: "https://casagroupproject.github.io/template1/assets/Tent_Poles_01.mtl",
			    mesh: null
			  }
			}

			init();
			animate();

			function init() {
			  //entire screen
			  canvas = document.getElementById("c");
			  //create array of internal geometries:
			  var template = document.getElementById("template").text;
			  
			  console.log('template-text',template);

			//get all divs
			  var allElements = document.querySelectorAll('.fh5co-portfolio-item');
			  //console.log('querySelectorAll',allElements[1]);
				
			  
			  var objLoader = new THREE.STLLoader();
			  var counter = 0;

//-------------------the mighty loop-----------------------------
			  for (var _key in models) {
			    //console.log('key first', _key);

			    //(function(key){

			    let scene = new THREE.Scene();
			    scene.background = new THREE.Color('rgb(0, 0, 0)');

			    //add helper axes
			    var axes = new THREE.AxisHelper(100);
    			scene.add(axes);

				//all divs
			    let element = document.createElement("div");
			    element.className = "fh5co-portfolio-figure";
			    //console.log('tempate replace', template);

			    //console.log('entire element', element);
			    //console.log('entire row', content);


			    ///console.log(element.querySelector(".scene"));

				//if counter is 0 append left div, if counter is 1 append right div:
				//console.log('countermodulo', counter%2==0);
				//if (counter%2==0){
					//console.log(element);
				allElements[counter].appendChild(element);
				element.innerHTML = template.replace('$', dens[counter]);
				// } else {
				// 	allElements[counter].appendChild(element);
				// 	element.innerHTML = template.replace('$', dens[counter]);
				// }

				let sceneElement = element.querySelector(".scene");
			    scene.userData.element = element.querySelector(".scene");

//-----------------------add labels--------------------------------
			    //let coords = [[75,0],[0,75],[-75,0],[0,-75]];
				//let dirs = ['N','E','W','S'];

				let coord = [60,0];

			    //for (var i=0; i<4; i++){
			    let sphereGeo = new THREE.SphereGeometry(0.1, 0.1, 0.1);
        		let sphereMesh = new THREE.Mesh(sphereGeo);
        		var divObj = new THREE.Object3D();
        		//console.log('coordinates', coords[i][0]);

        		//sphereMesh.position.set(20, 0, 20);
        		sphereMesh.position.set(coord[0],5,coord[1]);

        
        		scene.add(sphereMesh);
				//sphereMesh.updateMatrix();


				let divElem = document.createElement('div');
			    divElem.style.left = '509px';
			    divElem.style.top = '495px';
			    divElem.style.position = 'absolute';
			    divElem.style.color = 'white';
			    //divElem.innerHTML = '$';
			    //divElem.innerHTML = dirs[i]+'<div class="vl"></div>';
			    divElem.innerHTML = '<h8>North</h8> <div class="vl"></div>';
			    scene.userData.element.appendChild(divElem);
			    divObj.position = sphereGeo.vertices[0].clone();
			    //console.log(sphereGeo.vertices[0].clone());
			    //console.log(sphereGeo.vertices);
			    sphereMesh.add(divObj);
			        
			 	let objData = {
			            mesh: sphereMesh,
			            divElem: divElem,
			            divObj: divObj
			        };

//-------------------camera-----------------------------
			    let camera = new THREE.OrthographicCamera(
				    allElements[counter].clientWidth / -12, // frustum left plane
				    allElements[counter].clientWidth / 12, // frustum right plane.
				    allElements[counter].clientHeight / 10, // frustum top plane.
				    allElements[counter].clientHeight/ -13, // frustum bottom plane. 
				    -500, // frustum near plane.
				    500 // frustum far plane.
				);

			    //console.log('clientwidth', allElements[counter].clientWidth);
			    //console.log('clientheight', allElements[counter].clientHeight);

				camera.position.x = 80;
				camera.position.z = 80;
				camera.position.y = 35;

				scene.userData.camera = camera;


			  //-------------------element to add label to -----------------------------
		// function onCameraChange()
		// 	{
		// 	    objArr.forEach(function(objData) {
		// 	        console.log('this gets changed objData', objData);
		// 	        var proj = toScreenPosition(objData.divObj, camera);
			         
			        
		// 	        objData.divElem.style.left = proj.x + 'px';
		// 	        objData.divElem.style.top = proj.y + 'px'; 
		// 	        console.log('onCameraChange  - positionchange', objData.divElem.style.left);       
			        
		// 	    });
		// 	}

		function onCameraChange()
			{
			    //objArr.forEach(function(objData) {
			        //console.log('this gets changed objData', objData);
			        var proj = toScreenPosition(objData.divObj, camera);
			        //console.log('divObj', divObj)
			        //console.log('divelem', divElem)
			        objData.divElem.style.left = proj.x + 'px';
			        objData.divElem.style.top = proj.y + 'px';       
			        
			    //});
			}


			function toScreenPosition(obj, camera)
			{
			    
			    var vector = new THREE.Vector3();
			    
			    // TODO: need to update this when resize window
			    var widthHalf = 0.5*element.clientHeight;
			    var heightHalf = 0.5*element.clientHeight;
			    //console.log('renderer.context.canvas.height',renderer.context.canvas.height);
			    //console.log('renderer.context.canvas.height',element.clientHeight);

			    obj.updateMatrixWorld();
			    vector.setFromMatrixPosition(obj.matrixWorld);
			    vector.project(camera);
			    
			    vector.x = ( vector.x * widthHalf ) + widthHalf;
			    vector.y = - ( vector.y * heightHalf ) + heightHalf;
			    
			    return { 
			        x: vector.x,
			        y: vector.y
			    };

			}

				


//-------------------STL loader-----------------------------
			  objLoader.load(models[_key].obj, function ( geometry ) {

			                    // material = new THREE.MeshPhongMaterial( { color: 0xfdf894, specular: 0x111111, shininess: 200 } );
			                    //console.log('test', geometry.attributes.position.count);
			                    material = new THREE.MeshNormalMaterial();
			                    mesh = new THREE.Mesh( geometry, material );
			                    //pos1:moves to the right if positive. pos2: goes up if positive, down if neg
			                    //mesh.position.set(100, 0, 0 );
			                    //mesh.rotation.set( 0, 0, 0 );
			                    mesh.position.set(64, 0, -64);
			                    mesh.scale.set( 1, 1, 1);
			                    //mesh.position(0,0,0);

			                    mesh.castShadow = true;
			                    mesh.receiveShadow = true;

			                    scene.add( mesh );
			                    //camera.lookAt(mesh.position);
			                 //get size of object
			           var box = new THREE.Box3().setFromObject(mesh);
			      //console.log( box.min, box.max, box.getSize() );
			      //console.log(mesh.position);

			                } );

//-------------------some lights-----------------------------
			    scene.add(new THREE.HemisphereLight(0xaaaaaa, 0x444444));

			    var light = new THREE.DirectionalLight(0xffffff, 0.5);
			    light.position.set(70, 20, 0);
			    scene.add(light);
			    //console.log('scene number', scene);

			    
//-------------------controls-----------------------------
			    let controls = new THREE.OrbitControls(scene.userData.camera, scene.userData.element);
			    controls.minDistance = 2;
			    controls.maxDistance = 5;
			    controls.enablePan = true;
			    controls.enableZoom = true;
			    scene.userData.controls = controls;
			    controls.addEventListener('change', function() {
			        onCameraChange();
			        console.log('controls event listener');
			    });



			    scenes.push(scene);
			    counter ++;

			  }



//-------------------renderer-----------------------------
			  renderer = new THREE.WebGLRenderer({
			    canvas: canvas,
			    antialias: true
			  });
			  renderer.setClearColor(0xffffff, 1);
			  renderer.setPixelRatio(window.devicePixelRatio);

			}

			function updateSize() {

			  var width = canvas.clientWidth;
			  var height = canvas.clientHeight;

			  if (canvas.width !== width || canvas.height !== height) {

			    renderer.setSize(width, height, false);

			  }

			}


			function animate() {

			  render();
			  requestAnimationFrame(animate);

			}

			function render() {

			  updateSize();

			  renderer.setClearColor(0xffffff);
			  renderer.setScissorTest(false);
			  renderer.clear();

			  renderer.setClearColor(0xe0e0e0);
			  renderer.setScissorTest(true);

			  scenes.forEach(function(scene) {

			    // so something moves
			    //scene.children[ 0 ].rotation.y = Date.now() * 0.001;

			    // get the element that is a place holder for where we want to
			    // draw the scene
			    var element = scene.userData.element;

			    // get its position relative to the page's viewport
			    var rect = element.getBoundingClientRect();

			    // check if it's offscreen. If so skip it
			    if (rect.bottom < 0 || rect.top > renderer.domElement.clientHeight ||
			      rect.right < 0 || rect.left > renderer.domElement.clientWidth) {

			      return; // it's off screen

			    }

			    // set the viewport
			    var width = rect.right - rect.left;
			    var height = rect.bottom - rect.top;
			    var left = rect.left;
			    var top = rect.top;

			    renderer.setViewport(left, top, width, height);
			    renderer.setScissor(left, top, width, height);

			    var camera = scene.userData.camera;

			    //camera.aspect = width / height; // not changing in this example
			    //camera.updateProjectionMatrix();

			    //scene.userData.controls.update();

			    renderer.render(scene, camera);

			  });

			}
	</script>
	<!-- <script src="./assets/typewriter.js"></script> -->

	
	</body>
</html>
